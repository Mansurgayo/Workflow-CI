name: MLflow Skilled CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  mlflow-ci:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Set up job
      - name: Set up job
        run: echo "‚úÖ Job setup started"

      # 2Ô∏è‚É£ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 3Ô∏è‚É£ Set up Conda environment (Python 3.12.7)
      - name: Set up Conda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-update-conda: true
          python-version: 3.12
          environment-file: MLProject/conda.yaml  # path benar
          activate-environment: mlflow-env       # nama environment di conda.yaml
          auto-activate-base: false

      # 4Ô∏è‚É£ Check Environment
      - name: Check Python and Conda packages
        run: |
          python --version
          conda list

      # 5Ô∏è‚É£ Install additional dependencies (opsional)
      - name: Install additional Python dependencies
        run: echo "‚ö° Optional step for extra packages"

      # 6Ô∏è‚É£ Set MLflow Tracking URI
      - name: Set MLflow Tracking URI
        run: |
          export MLFLOW_TRACKING_URI=file://$(pwd)/mlruns
          echo "MLFLOW_TRACKING_URI set to $MLFLOW_TRACKING_URI"

      # 7Ô∏è‚É£ Run MLflow project
      - name: Run MLflow Project
        run: python modelling.py

      # 8Ô∏è‚É£ Additional dependency step (opsional)
      - name: Install additional Python dependencies (optional)
        run: echo "‚ö° Optional additional dependencies"

      # 9Ô∏è‚É£ Upload to Google Drive (opsional)
      - name: Upload to Google Drive
        run: |
          echo "‚ö†Ô∏è Tahapan ini opsional"
          echo "Jika ingin upload, sesuaikan metode: PyDrive, gdrive CLI, atau artifact GitHub"
          # gdrive upload --recursive MLProject/drive_upload

      # 10Ô∏è‚É£ Post set up Python / Conda
      - name: Post Python/Conda setup
        run: echo "‚úÖ Post Python/Conda setup completed"

      # 11Ô∏è‚É£ Post Run actions/checkout@v3
      - name: Post checkout
        run: echo "‚úÖ Post checkout completed"

      # 12Ô∏è‚É£ Complete job
      - name: Complete job
        run: echo "üéØ MLflow Skilled CI Job completed"
