name: MLflow Skilled CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  mlflow-ci:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Set up job
      - name: Set up job
        run: echo "‚úÖ Job setup started"

      # 2Ô∏è‚É£ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 3Ô∏è‚É£ Set up Python 3.12.7
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.12.7

      # 4Ô∏è‚É£ Check Environment
      - name: Check Python and pip versions
        run: |
          python --version
          pip --version

      # 5Ô∏è‚É£ Install dependencies
      - name: Install Python dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # 6Ô∏è‚É£ Set MLflow Tracking URI
      - name: Set MLflow Tracking URI
        run: |
          export MLFLOW_TRACKING_URI=file://$(pwd)/mlruns
          echo "MLFLOW_TRACKING_URI set to $MLFLOW_TRACKING_URI"

      # 7Ô∏è‚É£ Run MLflow project
      - name: Run MLflow Project
        run: |
          python modelling.py

      # 8Ô∏è‚É£ Install Python dependencies (opsional tambahan)
      - name: Install additional Python dependencies
        run: echo "‚ö° Additional dependencies step (opsional)"

      # 9Ô∏è‚É£ Upload to Google Drive (opsional)
      - name: Upload to Google Drive
        run: |
          echo "‚ö†Ô∏è Tahapan ini opsional"
          echo "Jika ingin upload, sesuaikan metode: PyDrive, gdrive CLI, atau artifact GitHub"
          # Contoh placeholder:
          # gdrive upload --recursive MLProject/drive_upload

      # 10Ô∏è‚É£ Post set up Python 3.12.7
      - name: Post Python setup
        run: echo "‚úÖ Post Python setup completed"

      # 11Ô∏è‚É£ Post Run actions/checkout@v3
      - name: Post checkout
        run: echo "‚úÖ Post checkout completed"

      # 12Ô∏è‚É£ Complete job
      - name: Complete job
        run: echo "üéØ MLflow Skilled CI Job completed"
